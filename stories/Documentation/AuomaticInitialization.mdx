import { Meta, Story } from "@storybook/addon-docs/blocks";

<Meta
  title="Getting started/Automatic Component Initialization"
/>

# Automatic Component Initialization

**First available in version 1.4.0**

The UNDP Design System now includes an automatic initialization system that simplifies component integration by eliminating the need to manually call JavaScript initialization functions.

## Overview

Components in the UNDP Design System often require JavaScript initialization to enable their full functionality. Traditionally, this required manually calling initialization functions in your JavaScript code:

```javascript
$(document).ready(function() {
  // Initialize components manually
  select();
  accordion();
  modal();
  // And so on...
});
```

With the automatic initialization system, you can now simply add data attributes to your HTML elements, and the components will initialize themselves when the page loads:

```html
<div class="select-box" data-undpds-component="custom-select">
  <!-- Component content -->
</div>
```

## Benefits

- **Simplified Integration**: No need to write JavaScript initialization code
- **Reduced Errors**: Prevents forgetting to initialize components
- **Consistent Behavior**: Components are initialized at the appropriate time in the page lifecycle
- **Independent Components**: Each component can be initialized separately
- **Automatic Error Handling**: Provides useful console warnings if initialization fails

## How to Use

### 1. Include the Component Initializer

Add the component initializer script to your HTML after including jQuery and the component-specific JS files:

```html
<!-- jQuery (required) -->
<script src="https://cdn.jsdelivr.net/npm/jquery@4.0.0-beta.2/dist/jquery.min.js"></script>

<!-- Component JS files -->
<script src="https://cdn.jsdelivr.net/npm/@undp/design-system-assets/js/component-name.min.js"></script>

<!-- Component Initializer (add this last) -->
<script src="https://cdn.jsdelivr.net/npm/@undp/design-system-assets/js/init.js" defer></script>
```

### 2. Add Data Attributes to Your HTML

Add the appropriate `data-undpds-component` attribute to your component elements:

```html
<element class="component-class" data-undpds-component="component-name">
  <!-- Component content -->
</element>
```

#### Multiple Components on One Element

**Available in version 1.6.0+**

You can initialize multiple components on the same element by providing a comma-separated list of component names:

```html
<div class="heading-big" data-undpds-component="change-background, fitTitle">
  <!-- Element will initialize both change-background and fitTitle components -->
</div>
```

This is useful when multiple behaviors need to be applied to the same element, such as:
- Combining `fitTitle` with `change-background` for dynamic text sizing with background effects
- Adding `fitText` to elements that already have other component functionality

The initialization system will:
- Parse the comma-separated list
- Initialize each component independently
- Track which components have been initialized in the `data-initialized` attribute
- Skip components that are already initialized on subsequent calls

### 3. That's it!

The components will automatically initialize when the page loads. No additional JavaScript is required.

## Supported Components

The following components can be initialized automatically using data attributes:

- Custom Select
- Multi Select
- Expand Search
- Language Switcher
- Country Header
- Country Site Header
- Accordion
- Modal
- Filter and Search Bar
- Stats Slider
- Footer
- Our Expertise
- Stats Cards
- Parallax Gallery
- HomePage Hero
- PageHero Cards
- Lightbox Gallery
- Language Switcher
- Modal
- Tabs
- Stats
- Stats Card Slider
- Download Modal
- Sidebar
- BioCard
- Fixed Size Carousel
- Fluid Image Size Carousel
- Image Only Carousel
- Lightbox Gallery
- ParallaxGallery
- Page Hero

## Additional Component Attributes

Some components support additional data attributes to configure their behavior:

### Accordion

```html
<ul class="accordion" data-undpds-component="accordion" data-multi-expand="true">
  <!-- Allows multiple accordion panels to be open simultaneously -->
</ul>
```

### Country Header

```html
<header class="country-header" data-undpds-component="country-header" data-overflow="true">
  <!-- Enables overflow menu functionality -->
</header>
```

## Examples

### Custom Select

```html
<div class="select-box" data-select="" data-undpds-component="custom-select">
  <button type="button" aria-haspopup="listbox" aria-label="Select" data-select-open="">
    Select Language
  </button>
  <ul role="listbox" data-select-options="">
    <li role="option" tabIndex="0" data-value="default">
      <span>All</span>
    </li>
    <li role="option" tabIndex="0" data-value="en">
      <span>English</span>
    </li>
  </ul>
</div>
```

### Accordion

```html
<ul class="accordion" aria-label="accordion" data-undpds-component="accordion">
  <li>
    <button tabIndex="0" aria-expanded="false">
      Section Header
    </button>
    <div class="accordion__panel" aria-hidden="true" role="region">
      <p>Panel content goes here</p>
    </div>
  </li>
  <li>
    <button tabIndex="0" aria-expanded="false">
      Another Section
    </button>
    <div class="accordion__panel" aria-hidden="true" role="region">
      <p>More content here</p>
    </div>
  </li>
</ul>
```

### Multiple Components (v1.6.0+)

```html
<div class="heading-big" data-undpds-component="change-background, fitTitle">
  <!-- This element will have both change-background and fitTitle initialized -->
  <h1>Dynamic Heading</h1>
</div>
```

After initialization, the `data-initialized` attribute will contain:
```html
<div class="heading-big" 
     data-undpds-component="change-background, fitTitle" 
     data-initialized="change-background,fitTitle">
  <h1>Dynamic Heading</h1>
</div>
```

### Modal (BioCard)

```html
<div class="grid-x" data-undpds-component="modal">
  <div class="cell bio-card medium large-3">
    <a href="#" title="bio-card" role="button" data-toggle="modal" data-target-modal="#bioCard">
      <!-- BioCard content -->
    </a>
  </div>
</div>
```

## How It Works

The component initializer:

1. Finds all elements with `data-undpds-component` attributes
2. Parses the attribute value as a comma-separated list of component names
3. Checks which components are already initialized by reading the `data-initialized` attribute
4. For each component that hasn't been initialized:
   - Calls the appropriate initialization function based on the component name
   - Checks for any additional configuration attributes
   - Marks the component as initialized in the `data-initialized` attribute (comma-separated list)
5. Provides console warnings if initialization functions aren't available

The `data-initialized` attribute stores a comma-separated list of initialized component names, allowing the same element to have multiple components initialized independently.

## Migration Guide

If you're updating from a previous version of the UNDP Design System, you can easily migrate to the automatic initialization system:

1. Add the component initializer script to your HTML
2. Add the appropriate `data-undpds-component` attributes to your component elements
3. Remove manual initialization function calls from your JavaScript

Your components will now initialize automatically while maintaining the same functionality.

## Browser Support

The automatic initialization system is supported in all browsers supported by the UNDP Design System. See the [Browser Support](?path=/docs/getting-started-browser-support--docs) page for details.
